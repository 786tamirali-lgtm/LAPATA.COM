<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LAPATA PORTAL - 786 तामीर अली</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database-compat.js"></script>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&family=Noto+Sans+Devanagari:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        :root { --primary: #1a237e; --secondary: #1976d2; --success: #2e7d32; --danger: #d32f2f; }
        body { font-family: 'Poppins', 'Noto Sans Devanagari', sans-serif; background: #f0f2f5; margin: 0; }
        .header { background: linear-gradient(135deg, var(--primary), #283593); color: white; padding: 30px; text-align: center; cursor: pointer; }
        .container { max-width: 1100px; margin: -40px auto 20px; background: white; border-radius: 20px; box-shadow: 0 10px 40px rgba(0,0,0,0.1); overflow: hidden; }
        .tabs { display: flex; background: #eee; border-bottom: 2px solid #ddd; }
        .tab { flex: 1; padding: 20px; text-align: center; cursor: pointer; font-weight: bold; transition: 0.3s; }
        .tab.active { background: white; color: var(--secondary); border-bottom: 4px solid var(--secondary); }
        .content { padding: 40px; display: none; min-height: 400px; }
        .content.active { display: block; }
        .form-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; font-weight: bold; color: var(--primary); }
        input, select { width: 100%; padding: 14px; border: 2px solid #e0e0e0; border-radius: 10px; font-size: 16px; box-sizing: border-box; }
        .btn { padding: 16px; border-radius: 10px; border: none; cursor: pointer; font-weight: bold; width: 100%; font-size: 16px; transition: 0.3s; }
        .btn-success { background: var(--success); color: white; }
        .btn-success:hover { background: #1b5e20; }
        #tab-link-manage { display: none; background: #ffebee; color: var(--danger); }
        .dashboard-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; }
        .stat-card { background: #f8f9fa; padding: 25px; border-radius: 15px; text-align: center; border: 1px solid #eee; }
        .person-card { border: 1px solid #eee; padding: 15px; margin-bottom: 10px; border-radius: 10px; display: flex; justify-content: space-between; align-items: center; }
    </style>
</head>
<body>

<div class="header" id="adminTrigger">
    <h1>LAPATA PORTAL</h1>
    <p>786 तामीर अली - महासंग्रह: अक्ल की जीत</p>
</div>

<div class="container">
    <div class="tabs">
        <div class="tab active" onclick="openTab('reg')"><i class="fas fa-user-plus"></i> पंजीकरण</div>
        <div class="tab" onclick="openTab('search')"><i class="fas fa-search"></i> खोजें</div>
        <div class="tab" id="tab-link-manage" onclick="openTab('manage')"><i class="fas fa-user-shield"></i> तामीर अली एडमिन</div>
    </div>

    <div id="reg" class="content active">
        <h2 style="color: var(--primary);">नया पंजीकरण</h2>
        <div class="form-group">
            <label>नाम / Name *</label>
            <input type="text" id="reg-name" placeholder="नाम दर्ज करें">
        </div>
        <div style="display: flex; gap: 15px;">
            <div class="form-group" style="flex:1;">
                <label>लिंग / Gender *</label>
                <select id="reg-gender">
                    <option value="male">पुरुष / Male</option>
                    <option value="female">महिला / Female</option>
                </select>
            </div>
            <div class="form-group" style="flex:1;">
                <label>श्रेणी / Category *</label>
                <select id="reg-category">
                    <option value="child">बच्चा / Child</option>
                    <option value="adult">वयस्क / Adult</option>
                </select>
            </div>
        </div>
        <div class="form-group">
            <label>उम्र / Age *</label>
            <input type="number" id="reg-age" placeholder="उम्र लिखें">
        </div>
        <button class="btn btn-success" onclick="processRegistration()"><i class="fas fa-cloud-upload-alt"></i> सुरक्षित करें</button>
    </div>

    <div id="search" class="content">
        <h2 style="color: var(--primary);">अक्ल की जीत डैशबोर्ड</h2>
        <div class="dashboard-grid">
            <div class="stat-card"><h3>कुल (Total)</h3><div id="totalCount" style="font-size: 32px; font-weight: bold;">0</div></div>
            <div class="stat-card"><h3>सुरक्षित (Found)</h3><div id="foundCount" style="font-size: 32px; color: green; font-weight: bold;">0</div></div>
        </div>
        <hr style="margin: 30px 0;">
        <input type="text" id="searchInput" onkeyup="searchPerson()" placeholder="नाम या आईडी से खोजें...">
        <div id="searchResults" style="margin-top: 20px;"></div>
    </div>

    <div id="manage" class="content">
        <h2 style="color: var(--danger);">प्रशासकिक नियंत्रण</h2>
        <div id="adminList"></div>
    </div>
</div>

<script>
    // Developer Provided Firebase Config
    const firebaseConfig = {
      apiKey: "AIzaSyDyxgyUhV4u7Fjort1GpOtoI_FTU3X3IFk",
      authDomain: "lapata-portal.firebaseapp.com",
      projectId: "lapata-portal",
      storageBucket: "lapata-portal.firebasestorage.app",
      messagingSenderId: "627466745113",
      appId: "1:627466745113:web:9fbcdc6b99103f336fc188",
      databaseURL: "https://lapata-portal-default-rtdb.firebaseio.com" // Default URL base
    };

    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    // Admin Access (786)
    let clicks = 0;
    document.getElementById('adminTrigger').onclick = function() {
        clicks++;
        if (clicks === 5) {
            let code = prompt("तामीर अली जी, गुप्त कोड दर्ज करें:");
            if (code === "786") {
                document.getElementById('tab-link-manage').style.display = "flex";
                openTab('manage');
                alert("अभिवादन तामीर अली जी!");
            }
            clicks = 0;
        }
    };

    function openTab(id) {
        document.querySelectorAll('.content').forEach(c => c.classList.remove('active'));
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        event.currentTarget.classList.add('active');
    }

    function processRegistration() {
        const name = document.getElementById('reg-name').value;
        const age = document.getElementById('reg-age').value;
        const gender = document.getElementById('reg-gender').value;
        const category = document.getElementById('reg-category').value;

        if (name && age) {
            const personId = 'LAP' + Date.now().toString().slice(-4);
            database.ref('persons/' + personId).set({
                id: personId, name, age, gender, category, status: 'missing', date: new Date().toISOString()
            }).then(() => {
                alert("✅ डेटा सुरक्षित हो गया!");
                document.getElementById('reg-name').value = '';
                document.getElementById('reg-age').value = '';
            });
        } else { alert("सभी जानकारी भरें!"); }
    }

    database.ref('persons/').on('value', (snap) => {
        const data = snap.val() ? Object.values(snap.val()) : [];
        document.getElementById('totalCount').innerText = data.length;
        document.getElementById('foundCount').innerText = data.filter(p => p.status === 'found').length;
        displayData(data);
    });

    function displayData(data) {
        const container = document.getElementById('searchResults');
        container.innerHTML = data.map(p => `
            <div class="person-card">
                <div><strong>${p.name}</strong> (${p.age} वर्ष) - ID: ${p.id}</div>
                <div style="color: ${p.status === 'missing' ? 'orange' : 'green'}">${p.status === 'missing' ? 'खोज जारी' : 'मिल गया'}</div>
            </div>
        `).join('');
    }
</script>
</body>
</html>
